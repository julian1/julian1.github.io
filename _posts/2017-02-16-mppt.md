---
title: Notes on MPPT and buck converter
layout: default
---

![pic](/public/images/buck/DSC02975.JPG)

*A simple buck converter with the 2n7000 mosfet gate driven by a signal-generator*

I have been thinking about what would be required to create a switch-mode analog MPPT system to charge a small battery. Ideally, small and low-powered - something suitable for a solar-powered wireless [3.3V ESP8266](https://en.wikipedia.org/wiki/ESP8266). 

### Possible Design
  - two differentiating op-amp circuits. One for change in power over time, and the other for change in regulation point over time.
  - a four-quadrant analog multiplier to divide the two values to produce delta power/ delta regulation point - for the basic negative feedback response
  - a pid loop for regulation
  - perhaps another multiplier to generate the power signal from voltage and a current-sense resistor. Although a LiPO4 battery has very small voltage differences between charging and discharging - so may be able to rely just on current.


### Buck converter
  - Using the battery as sink, a design could be quite similar to a buck-converter. The feedback would control the sink current via PWM, to maximize power. 

### PWM device
  - [LTC6992 pdf](http://cds.linear.com/docs/en/datasheet/69921234fc.pdf) looks nice. Voltage control of frequency and PWM. Upto 1MHz. And 0-100% PWM. Imporantly it can run off 2.25V to 5.5V single supply.

### Multipiliers are hard! 

  - A [log/sum/anti-log approach](https://en.wikibooks.org/wiki/Electronics/Analog_multipliers) with op-amps only works with unipolar inputs while we need a bipolar inputs and outputs - a four quadrant multipler.
  - Sophisticated multiplier ICs like the [AD633 pdf](http://www.analog.com/media/en/technical-documentation/data-sheets/AD633.pdf) use an embedded zener as a reference. They all seem designed around higher voltage supplies and can't be used for a lower voltage (eg. 6V) single rail design.
  - A gilbert cell based on discrete transistors needs trimming. Use a matched transistor array? 
  - THe [HFA3101 pdf](http://www.intersil.com/content/dam/Intersil/documents/hfa3/hfa3101.pdf) is a Gilbert cell implemented with six matched bjts. But it's designed for GHz RF and not that widely available.
  - The [MC1496 pdf](http://www.onsemi.com/pub_link/Collateral/MC1496-D.PDF) is a RF modulator multiplier based on a Gilbert Cell, but suffers from non-linearity - else it looks pretty good. Fig 23 has an IC schematic. It pulls out all the useful pins - so can control the biasing.
  - Another choice is an OTA such as the [LM13700M pdf](http://www.farnell.com/datasheets/2020636.pdf). There is a four-quadrant multiplier based on the OTA on Fig. 24.

Some good notes on multipliers can be found in [Analog Devices tutorial pdf](http://www.analog.com/media/en/training-seminars/tutorials/MT-079.pdf)

### Mosfet drivers
  - Conventional buck converters and drivers often use two n-channel devices, and rely on a boost capactitor to drive the high-side mosfet gate in a source-follower configuration. Not sure if a p-channel on high-side might not be simpler - even with higher RDS(on) compared with an n-channel. In a high voltage application (> 10-14V) the gate wouldn't need to be driven through as wide a voltage range. For low voltage - need to be logic level, or use voltage booster?. 

#### Battery
  - LiPO4 rather than Lithium for safety, and simplified charging management. See, [float charging etc](http://www.powerstream.com/LLLF.htm)

